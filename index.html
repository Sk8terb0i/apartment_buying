<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Apartment Shopping Tracker</title>
<style>
  table { border-collapse: collapse; width: 50%; margin: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  .highlight { background-color: #a0ffa0; }
</style>
</head>
<body>
<h1>Shopping Tracker</h1>
<table id="itemsTable">
  <thead>
    <tr>
      <th>Item</th>
      <th>Next Buyer</th>
      <th>Bought?</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const backendUrl = 'https://script.google.com/macros/s/AKfycbxv_FLPn0E8JU_ElVZ2pxZ32VNYdSELPY6CXOl4JGigbc1iwx2qHSUotz_O0GKC9oJU/exec';

async function loadData() {
  const response = await fetch(backendUrl);
  const items = await response.json();
  const tbody = document.querySelector('#itemsTable tbody');
  tbody.innerHTML = '';

  items.forEach(item => {
    const tr = document.createElement('tr');
    const nextBuyer = item.people[item.turnIndex];
    tr.innerHTML = `
      <td>${item.item}</td>
      <td class="highlight">${nextBuyer}</td>
      <td><input type="checkbox" data-item="${item.item}"></td>
    `;
    tbody.appendChild(tr);
  });

  document.querySelectorAll('input[type=checkbox]').forEach(cb => {
    cb.addEventListener('change', async (e) => {
      const itemName = e.target.dataset.item;
      await fetch(backendUrl, {
        method: 'POST',
        body: JSON.stringify({ item: itemName })
      });
      loadData(); // Refresh table
    });
  });
}

loadData();
</script>
</body>
</html>
